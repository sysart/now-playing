<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="https://fonts.googleapis.com/css?family=Fira+Mono" rel="stylesheet">
  <title>Musacorneri</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: 'Fira Mono', monospace;
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      background: #333;
      overflow: hidden;
      cursor: none;
    }

    h1 {
      width: 100%;
      padding: 30px;
      margin: 0;
      text-align: center;
      background: #292929;
      color: #1ed760;
      font-size: 90px;
      text-transform: uppercase;
    }

    .trackinfo {
      display: flex;
      flex-direction: column;
      width: 60%;
      flex: 1;
      justify-content: center;
      align-items: center;
      color: white
    }

    .artist {
      margin-top: 20px;
      font-size: 26px
    }

    .track {
      font-size: 16px;
      margin-bottom: 20px;
    }

    .albumart {
      height: 500px;
      width: 500px;
      border: 15px solid #292929;
    }

    .timebar {
      width: 500px;
      margin-left: 10px;
      margin-right: 10px;
      height: 10px;
      background: #999;
      border-radius: 5px;
      overflow: hidden;
    }

    .timehead {
      width: 0%;
      height: 10px;
      background: #1ed760;
    }

    .timeContainer {
      display: flex;
      align-items: center;
    }
  </style>
</head>

<body>
  <h1>
    Now playing
  </h1>

  <div class="trackinfo">
    <img class="albumart" src="" alt="">
    <div class="artist"></div>
    <div class="track"></div>

    <div class="timeContainer">
      <span class="currentTime"></span>
      <div class="timebar">
        <div class="timehead"></div>
      </div>
      <span class="totalTime"></span>
    </div>
  </div>
</body>

<script>
  function secondsToTime(s) {
    var sec_num = s // don't forget the second param
    var hours = Math.floor(sec_num / 3600);
    var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
    var seconds = sec_num - (hours * 3600) - (minutes * 60);

    if (hours < 10) { hours = "0" + hours; }
    if (minutes < 10) { minutes = "0" + minutes; }
    if (seconds < 10) { seconds = "0" + seconds; }
    return minutes + ':' + seconds;
  }

  // ID for current track
  let currentUri = null

  function main() {
    const e = {
      track: document.querySelector('.track'),
      artist: document.querySelector('.artist'),
      albumart: document.querySelector('.albumart'),
      time: document.querySelector('.timehead'),
      currentTime: document.querySelector('.currentTime'),
      totalTime: document.querySelector('.totalTime')
    }

    fetch("/track")
      .then(r => r.json())
      .then(track => {
        if (track.uri !== currentUri) {
          currentUri = track.uri
          e.track.innerHTML = track.title
          e.artist.innerHTML = track.artist
          e.albumart.src = track.albumArtURL
          e.totalTime.innerHTML = secondsToTime(track.duration)
        }

        e.time.style.width = String((track.position / track.duration) * 100) + "%"
        e.currentTime.innerHTML = secondsToTime(track.position)
      })
  }

  setInterval(() => {
    main();
  }, 1000)
</script>

</html>